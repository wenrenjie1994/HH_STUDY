**转换流笔记**  

----------


**一、字符编码和字符集**  
编码：字符 -> 字节  
解码：字节 -> 字符  
编码表：生活中文字和计算机中二进制的对应规则  

字符编码：就是一套自然语言的字符与二进制数之间的对应规则  
字符集：也叫编码表，是一个系统支持的所有字符的集合，包括各国家文字、标点符号、图形符号、数字等  
常见字符集：ASCII字符集、GBK字符集、Unicode字符集等  

**二、编码引出的问题_FileReader读取GBK文件乱码**  
FileReader可以读取默认编码格式（UTF-8）的文件  
FileReader读取系统默认编码（中文：GBK）会乱码  

**三、转换流的原理**  
GBK 中文码表 使用【两个字节】存储一个中文  
UTF-8 国际标准码表 使用【三个字节】存储一个中文  

**四、OutputStreamWriter介绍和代码实现**  
java.io.OutputStreamWriter extends   Writer：是字符流通向字节流的桥梁；可使用指定的charset将要写入流中的字符编码成字节（编码）  
继承自父类的共性成员方法：  

    1.void write(int c)：写入单个字符  
    
    2.void write(char[] cbuf)：写入字符数组
    
    3.abstract void write(char[] cbuf, int off, int len)：写入字符数组的某一部分；off--数组的开始索引，len--写的字符个数
    
    4.void write(String str)：写入字符串
    
    5.void write(String str, int off, int len)：写入字符串的某一部分；off--字符串的开始索引，len--写的字符个数
    
    6.void flush()：刷新该流的缓冲
    
    7.void close()：关闭此流，但要先刷新它

构造方法：  

    OutputStreamWriter(OutputStream out)：创建使用默认字符编码的OutputStreamWriter
    OutputStreamWriter(OutputStream out, String charsetName)：创建使用指定字符编码的OutputStreamWriter
    参数：
        OutputStream out：字节输出流，可以用来写转换之后的字节到文件中
        String charsetName：指定的编码表名称，不区分大小写，不指定则默认使用UTF-8

使用步骤【重点】：  
1.创建一个OutputStreamWriter对象，构造方法中传递OutputStream对象和指定的编码表名称  
2.使用OutputStreamWriter对象中的方法write，把字符转换为字节存储到缓冲区中（编码）  
3.使用OutputStreamWriter对象中的方法flush，把内存缓冲区中的字节刷新到文件中（使用字节流写字节的过程）  
4.释放资源  

**五、InputStreamReader介绍和代码实现**  
java.io.InputStreamReader extends   Reader：是字节流通向字符流的桥梁；它使用指定的charset读取字节并将其解码为字符（解码）  
继承自父类的共性成员方法：    

    1.int read()：读取单个字符并返回字符个数  
    
    2.int read(char[] cubf)：一次读取多个字符，将字符读入数组
    
    3.void close()：关闭并释放与之关联的所有资源

构造方法：  

    InputStreamReader(InputStream out)：创建使用默认字符编码的InputStreamReader
    InputStreamReader(InputStream out, String charsetName)：创建使用指定字符编码的InputStreamReader
    参数：
        InputStream out：字节输入流，用来读取文件中保存的字节
        String charsetName：指定的编码表名称，不区分大小写，不指定则默认使用UTF-8

使用步骤【重点】：  
1.创建一个InputStreamReader对象，构造方法中传递InputStream对象和指定的编码表名称  
2.使用InputStreamReader对象中的方法read，读取文件  
3.释放资源  

注意事项：构造方法中指定的编码表名称要和文件编码相同，否则会发生乱码  

**六、练习_转换文件编码**  
要求：将GBK编码的文本文件，转换为UTF-8编码的文本文件  

```java
package charset;

import java.io.*;

public class GbkToUtf8 {
    public static void main(String[] args) {
        InputStreamReader isr = null;
        OutputStreamWriter osw = null;
        try {
            //从gbk文件中读取gbk编码的数据
            isr = new InputStreamReader(new FileInputStream("E:\\IdeaProjects\\basic-code\\day0814-code\\src\\charset\\gbk.txt"),"GBK");
            //将gbk编码的数据转换成utf-8编码并写入到utf8.txt文件
            osw = new OutputStreamWriter(new FileOutputStream("E:\\IdeaProjects\\basic-code\\day0814-code\\src\\charset\\utf8.txt"),"UTF-8");
            int len = 0;
            while ((len = isr.read()) != -1) {
                osw.write(len);
            }
        } catch (FileNotFoundException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        } finally {
            try {
                if (osw != null) {
                    osw.close();
                }
                if (isr != null) {
                    isr.close();
                }
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    }
}
```